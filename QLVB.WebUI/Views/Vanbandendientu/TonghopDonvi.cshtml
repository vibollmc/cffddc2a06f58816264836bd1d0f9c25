@using QLVB.DTO
@{
    ViewBag.Title = "TonghopDonvi";
    string stremail = ViewBag.stremail;
    string strDonvi = ViewBag.strDonvi;
    string strngaykybd = ViewBag.strngaykybd;
    string strngaykykt = ViewBag.strngaykykt;
    int? intSoNgaygui = ViewBag.intSoNgaygui;
    int LoaiTonghop = ViewBag.LoaiTonghop;
    string filename = "ExportVBDenDientu_" + strDonvi + ".xlsx";
}
@section header{
    <i class="fa fa-file-text">&nbsp;</i>Tổng hợp văn bản đến điện tử của @strDonvi
}

<div class="row">
    <div class="col-sm-12" id="detail-listVBDenDonvi">
     @(Html.Kendo().Grid<QLVB.DTO.Vanbandientu.ListVanbandendientuViewModel>()
    .Name("grid")
    .Columns(columns =>
    {
        columns.Bound(c => c.intid).Hidden();
        columns.Bound(o => o.IsAttach).Title(" ")
            .ClientTemplate(
                "#if (IsAttach) { #" +
                    "<img onclick='ViewDetailVBDTDen(" + "#= intid #" + ")' alt='#= intid #' src='" + Url.Content("~/Content/Images/noidung_attach.gif") + "' />" +
                "# } else { #" +
                    "<img onclick='ViewDetailVBDTDen(" + "#= intid #" + ")' alt='#= intid #' src='" + Url.Content("~/Content/Images/noidung.gif") + "' />" +
                "# } #"
            )
            .Width(28);
        columns.Bound(o => o.dtengayky).Format("{0:dd/MM/yyyy}").Title("Ngày ký").Width(90);
        columns.Bound(o => o.intso).Title("Số ").Width(60);
        columns.Bound(o => o.strkyhieu).Title("Ký hiệu").Width("12%");
        columns.Bound(o => o.strtrichyeu).Title("Trích yếu nội dung").Width("20%");
        columns.Bound(o => o.strnoiguivb).Title("Đơn vị gửi").Width("14%");
        columns.Bound(o => o.dtengayguivb).Format("{0:dd/MM/yyyy HH:mm:ss }").Title("Ngày gửi").Width(90);
        columns.Bound(o => o.dtengaynhanvb).Format("{0:dd/MM/yyyy HH:mm:ss }").Title("Ngày nhận").Width(90);
        columns.Bound(o => o.inttrangthai).Hidden();
    })
    .HtmlAttributes(new { style = "white-space: normal" })
    .Scrollable()
        //.Sortable()
    .Selectable()
    .Resizable(resize => resize.Columns(true))
    .Pageable(pageable => pageable
        .Refresh(true)
        //.PageSizes(true)
        .ButtonCount(5)
        .Messages(ms => ms.Display(KendoGridDisplay.PageDisplay).Empty(KendoGridDisplay.PageEmpty)
            .First(KendoGridDisplay.PageFirst).Previous(KendoGridDisplay.PagePrevious)
            .Next(KendoGridDisplay.PageNext).Last(KendoGridDisplay.PageLast))
        )
    .DataSource(dataSource => dataSource
        .Ajax()
        .PageSize(QLVB.Common.Utilities.AppSettings.DisplayItemsPerPage)
                .Read(read => read.Action("TonghopVBDonvi_Read", "Vanbandendientu",
                new
                {
                    stremail = stremail,
                    strngaykybd = strngaykybd,
                    strngaykykt = strngaykykt,
                    intSoNgaygui = intSoNgaygui,
                    LoaiTonghop = LoaiTonghop
                })
            )
            .Events(events => events.Error("onError"))
        )
    .Events(events => events.Change("onChange").DataBound("onDataBound"))    
    .ToolBar(toolbar =>
        {
            toolbar.Template(@<text>
                <div class="toolbar">
                    <button id="Backbtn" type="button" class="btn btn-sm btn-primary btn-flat " data-original-title="" title="">
                        <i class="glyphicon glyphicon-arrow-left"></i>&nbsp;Quay lại
                    </button>
                    <a class="btn btn-sm btn-primary btn-flat button-box k-grid-excel" href="#">
                        <i class="glyphicon glyphicon-print"></i>&nbsp;In&nbsp;
                    </a>
                </div>
            </text>)
            ;
        })
            .Excel(excel => excel
                    .FileName(filename)
                    .Filterable(true)
                    .AllPages(true)
                    .ProxyURL(Url.Action("TonghopVBDonvi_Export", "Vanbandendientu"))
                )
        )

    </div>
</div>
<script type="text/javascript">
    $(window).resize(function () {
        SetGridHeight();
    });
    $(document).ready(function () {
        SetGridHeight();
    })
    function onChange(arg) {
        var selected = $.map(this.select(), function (item) {
            var value = $(item).text();
            var grid = $("#grid").data("kendoGrid");
            var row = grid.select();
            var intid = grid.dataItem(row).intid;
            var inttrangthai = grid.dataItem(row).inttrangthai;
            var currentPage = grid.dataSource.page();

        });
    }
    function onDataBound(arg) {
        dataView = this.dataSource.view();
        for (var i = 0; i < dataView.length; i++) {
            if (dataView[i].inttrangthai == 0) {
                var uid = dataView[i].uid;
                $("#grid tbody").find("tr[data-uid=" + uid + "]").addClass("chuaduyet");
            }
        }
    }
    
    function onError(e, status) {
        SetThongbao("Đã có lỗi xảy ra trên Server!");
    }
    function ViewDetailVBDTDen(id) {
        OpenViewDetailVBDTDen(id);
    }
    $('#Backbtn').click(function () {
        var url = '@Url.Action("Tonghop", "Vanbandendientu")';
        window.location = url;
    });

</script>
@Html.Action("_ViewDetailVBDTDen", "Vanbandendientu")



