@*@model QLVB.DTO.Hoso.AddYkienViewModel*@

<div class="box " id="tbar">
	<header>
		<nav style="padding: 3px;">
			<button id="SaveYkienbtn" type="button" class="btn btn-sm btn-primary btn-flat " data-original-title="" title=""><i class="glyphicon glyphicon-floppy-saved"></i>&nbsp;Ghi nhận</button>
			<button id="BackYkienbtn" type="button" class="btn btn-sm btn-primary btn-flat " data-original-title="" title=""><i class="glyphicon glyphicon-arrow-left"></i>&nbsp;Quay lại</button>

		</nav>
	</header>
</div>
<div class="row">
	<div id="txtykien" class="col-sm-11">
		<form class="form-horizontal" id="formAddYkien">
			@Html.TextArea("strykienxuly", new { @class = "form-control form-control-window", rows = 15 })
		</form>
	</div>
	<div class="col-sm-4" id="detail-UploadYkien" style="display:none;">        
		<input name="files" id="files" type="file" />
	</div>
</div>


<script type="text/javascript">	
	$('#SaveYkienbtn').click(function () {
		var idhoso = GetIdHoso();
		var strykien = $('#strykienxuly').val();		
		$.ajax(
		{
			type: "POST",
			url: '@Url.Action("_SaveYkien", "Hoso")',
			data: { 'idhoso': idhoso, 'strykien': strykien },
			success: function (idykien) {
				if (idykien == 0) {
					SetThongbao("Lỗi!!!");					
				}
				else {
					$('#txtykien').removeClass("col-sm-11");
					$('#txtykien').addClass("col-sm-6");
					ReloadThongtinxuly();
					EnableUploadYkien(idykien, idhoso);
					$('#detail-UploadYkien').show();					
				}
			},
			dataType: "Json"
		});
	});
	function EnableUploadYkien(idykien, idhoso) {
		var urlykien = "?idykien=" + idykien + "&idhoso=" + idhoso;

		var urlUpload = '@Url.Action("UploadYkien", "File")';
		urlUpload += urlykien;

		var urlRemove = '@Url.Action("RemoveYkien", "File")';
		urlRemove += urlykien;

		$("#files").kendoUpload({
			async: {
				saveUrl: urlUpload,
				removeUrl: urlRemove,
				autoUpload: true
			}
			//template: kendo.template($('#fileTemplate').html())
		});
	};
	$('#BackYkienbtn').click(function () {
		ReloadThongtinxuly();
		CloseYkienxuly();
	});
	
</script>
