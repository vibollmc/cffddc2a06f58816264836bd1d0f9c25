@using QLVB.DTO
@{
    ViewBag.Title = "Chuc danh";
}
@section header{
    <i class="glyphicon glyphicon-user">&nbsp;</i>Chức danh
}
<div class="row">
    <!-- LIST NHOM QUYEN-->
    <div class="col-sm-12">
        <div class="box dark">
            <header>
                <nav style="padding: 3px;">
                    <button id="Addbtn" type="button" class="btn btn-sm btn-primary btn-flat " data-original-title="" title=""><i class="glyphicon glyphicon-plus"></i>&nbsp;Thêm</button>
                    <button id="Editbtn" type="button" class="btn btn-sm btn-primary btn-flat " data-original-title="" title=""><i class="glyphicon glyphicon-pencil"></i>&nbsp;Sửa</button>
                    <button id="Deletebtn" type="button" class="btn btn-sm btn-primary btn-flat " data-original-title="" title=""><i class="glyphicon glyphicon-trash"></i>&nbsp;Xóa</button>
                </nav>
            </header>
        </div>
        @(Html.Kendo().Grid<QLVB.DTO.Chucdanh.ListChucdanhViewModel>()
        .Name("grid")
        .Columns(columns =>
        {
            columns.Bound(o => o.intid).Hidden();
            columns.Bound(o => o.strmachucdanh).Title("Mã chức danh").Width("15%");
            columns.Bound(o => o.strtenchucdanh).Title("Tên chức danh").Width("30%");
            columns.Bound(o => o.Loaichucdanh).Title("Loại chức danh");
            columns.Bound(o => o.strghichu).Title("Ghi chú");
        })
        .HtmlAttributes(new { style = "white-space: normal" })
        .Scrollable()
        .Sortable()
        .Selectable()
        .Pageable(pageable => pageable
            .Refresh(true)
            //.PageSizes(true)
            .ButtonCount(5)
            .Messages(ms => ms.Display(KendoGridDisplay.PageDisplay).Empty(KendoGridDisplay.PageEmpty)
                .First(KendoGridDisplay.PageFirst).Previous(KendoGridDisplay.PagePrevious)
                .Next(KendoGridDisplay.PageNext).Last(KendoGridDisplay.PageLast))
            )
        .DataSource(dataSource => dataSource
            .Ajax()
            .PageSize(QLVB.Common.Utilities.AppSettings.DisplayItemsPerPage)
            .Read(read => read.Action("Chucdanh_Read", "Chucdanh"))
            )
        .Events(events => events.Change("onChange"))
        )
    </div>

    @Html.Hidden("idchucdanh")
</div>

<script type="text/javascript">
    $(window).resize(function () {
        SetGridHeight();
    });
    $(document).ready(function () {
        SetGridHeight();
    })
    function onChange(arg) {
        var selected = $.map(this.select(), function (item) {
            var value = $(item).text();
            var grid = $("#grid").data("kendoGrid");
            var row = grid.select();
            var intid = grid.dataItem(row).intid;
            SetIdChucdanh(intid);
            var url = '@Url.Action("_AjaxEditChucdanh", "Chucdanh", (new { id = "__id__" }))'.replace('__id__', intid);
            $('#detail-editChucdanh').load(url);
        });
    }
    function SetIdChucdanh(idchucdanh) {
        $("#idchucdanh").val(idchucdanh);
    }
    function GetIdChucdanh() {
        var idchucdanh = $("#idchucdanh").val();
        return idchucdanh;
    }
    $("#Addbtn").bind("click", function () {
        var id = 0;
        var url = '@Url.Action("_AjaxEditChucdanh", "Chucdanh", (new { id = "__id__" }))'.replace('__id__', id);
        $('#detail-editChucdanh').load(url);
        var window = $("#EditChucdanh").data("kendoWindow");
        window.center();
        window.open();
    });
    $("#Editbtn").bind("click", function () {
        var id = GetIdChucdanh();
        if (id != 0) {
            var url = '@Url.Action("_AjaxEditChucdanh", "Chucdanh", (new { id = "__id__" }))'.replace('__id__', id);
            $('#detail-editChucdanh').load(url);
            var window = $("#EditChucdanh").data("kendoWindow");
            window.center();
            window.open();
        } else {
            SetThongbao("Bạn chưa chọn chức danh")
        }
    });
    $("#Deletebtn").bind("click", function () {
        var id = GetIdChucdanh();
        if (id != 0) {
            var url = '@Url.Action("_AjaxDeleteChucdanh", "Chucdanh", (new { id = "__id__" }))'.replace('__id__', id);
            $('#detail-editChucdanh').load(url);
            var window = $("#EditChucdanh").data("kendoWindow");
            window.center();
            window.open();
        } else {
            SetThongbao("Bạn chưa chọn chức danh")
        }
    });
    function CloseEditChucdanh() {
        var window = $("#EditChucdanh").data("kendoWindow");
        window.close();
    }
</script>

@(Html.Kendo().Window()
    .Name("EditChucdanh")
    .Draggable()
    .AutoFocus(true)
    .Title("Cập nhật Chức danh")
    .Resizable()
    .Width(500)
    .HtmlAttributes(new { style = "height:100%;" })        
    .Visible(false)
    .Actions(actions => actions.Minimize().Maximize().Close())
    .Content(
    @<text>
        <div id="detail-editChucdanh">
        </div>
    </text>
    )
)


