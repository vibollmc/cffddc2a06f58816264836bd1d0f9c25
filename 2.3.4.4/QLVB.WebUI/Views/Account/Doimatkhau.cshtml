@model QLVB.DTO.Account.ChangePasswordViewModel

@{
    ViewBag.Title = "Doimatkhau";
}

@section header{
    <i class="glyphicon glyphicon-cog">&nbsp;</i>Đổi mật khẩu
}

<div class="row">
    <!-- HOP THU DIEN TU-->
    <div class="col-sm-12">
        <div class="box">
            <header>
                <nav style="padding: 3px;">
                    <button id="SavePassbtn" type="button" class="btn btn-sm btn-primary btn-flat " data-original-title="" title=""><i class="glyphicon glyphicon-floppy-saved"></i>&nbsp;Ghi nhận</button>

                </nav>
            </header>

            <span id="ketquaSavePass" class="validation-summary-valid"></span>
            <form class="form-horizontal" id="formChangePass">
                <div class="form-group form-group-window">
                    @Html.LabelFor(m => m.OldPassword, new { @class = "control-label col-sm-4" })
                    <div class="col-sm-6">
                        @Html.PasswordFor(m => m.OldPassword, new { @class = "form-control form-control-window", placeholder = "Mật khẩu cũ" })
                    </div>
                </div>
                <div class="form-group form-group-window">
                    @Html.LabelFor(m => m.NewPassword, new { @class = "control-label col-sm-4" })
                    <div class="col-sm-6">
                        @Html.PasswordFor(m => m.NewPassword, new { @class = "form-control form-control-window", placeholder = "Mật khẩu mới" })
                    </div>
                </div>
                <div class="form-group form-group-window">
                    @Html.LabelFor(m => m.ConfirmPassword, new { @class = "control-label col-sm-4" })
                    <div class="col-sm-6">
                        @Html.PasswordFor(m => m.ConfirmPassword, new { @class = "form-control form-control-window", placeholder = "Xác nhận lại" })
                    </div>
                </div>
            </form>

        </div><!--end box-->

    </div>
</div>


<script type="text/javascript">
    var validatable = $("#formChangePass").kendoValidator({
        rules: {
            password: function (input) {
                if (input.is("[name=ConfirmPassword]")) {
                    var strpassword = $('#NewPassword').val();                        
                    var ConfirmPassword = $('#ConfirmPassword').val();
                    if (strpassword != "") {                            
                        if (strpassword != ConfirmPassword) {
                            return false;
                        } else {
                            return true;
                        }
                    } else {
                        return true;
                    }
                }
                return true;
            }
        },
        messages: {
            password: "Mật khẩu xác nhận không đúng"                
        }
    }).data("kendoValidator");
    $("#SavePassbtn").bind("click", function () {
        if (validatable.validate()) {
            $.ajax({
                type: "POST",
                url: '@Url.Action("ChangePass", "Account")',
                dataType: "json",
                data: $('#formChangePass').serialize(),
                success: function (data) {
                    if (data == 1) {
                        ShowResult("ketquaSavePass", "Cập nhật thành công");
                    }
                    else {
                        ShowResult("ketquaSavePass", "Lỗi !!!");
                    }
                },
            });
        }
    });   
    
</script>